for(var jpText=document.getElementsByClassName("wrapped-japanese"),i=0;i<jpText.length;i++){var dType,inHT=jpText[i].innerHTML;if(-1===inHT.indexOf("[")||inHT.match(/\[\d/gm)&&!inHT.match(/\[\D/gm))jpText[i].style.visibility="visible";else if(dType=jpText[i].getAttribute("display-type")){dType=dType.toLowerCase();var displayModes=["hover","coloredhover","coloredkanji","reading","coloredreading","kanjireading","coloredkanjireading","kanji"];if(-1!=displayModes.indexOf(dType)){var textMatches,txtM,brackMatches,colored=!0;"c"!==dType.charAt(0)&&(colored=!1),[inHT,brackMatches]=bracketEscape(inHT);var htmlMatches,reading=!1;if("reading"!=dType&&"coloredreading"!=dType?[inHT,htmlMatches]=htmlEscape(inHT):reading=!0,BUFFERED_OUTPUT){if(jpText[i].style.visibility="visible",textMatches=inHT.match(/.{1,500}(?=\s|$)/gm)){jpText[i].innerHTML="";for(var m=0;m<textMatches.length;m++)txtM=textMatches[m],doSetTimeout(m,txtM,jpText[i],textMatches.length,htmlMatches,brackMatches,dType,PITCH_GRAPHS,PITCH_SHAPES,FG_FONT_SIZE,colored,reading)}}else txtM=formatJapanese(inHT,dType,PITCH_GRAPHS,PITCH_SHAPES,FG_FONT_SIZE,colored,reading),htmlMatches&&(txtM=returnHTML(txtM,htmlMatches)),setInHTML(txtM,jpText[i],htmlMatches,brackMatches)}}}